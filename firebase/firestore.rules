rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // match /{document=**} {
    //   allow read, write: if false;
    //}

    match /notebooks/{notebook_id} {

      allow read, delete: if request.auth != null && request.auth.uid == resource.data.user;
      allow create, update: if request.auth != null && request.auth.uid == request.resource.data.user;

    }

    match /notebooks/{notebook_id}/notes/{note_id} {

      allow read, delete: if request.auth != null
                          && get(/databases/$(database)/documents/notebooks/$(notebook_id)).data.user == request.auth.uid;

      allow create, update: if request.auth != null && request.auth.uid == request.resource.data.user
                            && request.resource.data.notebook == notebook_id
                            && get(/databases/$(database)/documents/notebooks/$(notebook_id)).data.user == request.auth.uid;

    }
  }
}